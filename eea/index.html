<!DOCTYPE html>
<html>
  <head>
    <meta name="robots" content="noindex">
    <meta charset="UTF-8" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
      />
    <style>
      table, th, td {
          border-left: 1px solid black;
          border-right: 1px solid black;
          text-align: center;
      }
      #erg {
          font-weight: bold;
          padding: 10px;
      }
    </style>
    <title>Extended Euclidean algorithm (EEA) Generator</title>
  </head>
  <body>
    <main>
      <div class="px-4 py-5 my-5 text-center">
        <h1 class="display-5 fw-bold">
          EEA
        </h1>
        <div class="mx-auto">
          Extended Euclidean algorithm generator
        </div>
      </div>

      <div class="container">
        <div class="card mb-3">
          <div class="card-body">
            <form id="form">
              <div class="mb-3">
                <label for="a" class="form-label">a:</label>
                <input id="a" type="number" name="a" placeholder="a" class="form-control" required>
              </div>
              <div class="mb-3">
                <label for="b" class="form-label">b:</label>
                <input id="b" type="number" name="b" placeholder="b" class="form-control" required>
              </div>
              <button type="submit" id="submit" class="btn btn-primary">Generate table</button>
            </form>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <div id="erg"></div>
            <div class="table-responsive" id="resultDiv"></div>
          </div>
        </div>
      </div>
    </main>

  </body>

  <script src="../static/table.js"></script>
  <script>
    function generateTable(event) {
        event.preventDefault()

        const form = document.getElementById("form");

        if (!form.checkValidity()) {
            return;
        }
        else {
            form.classList.add("was-validated");
        }
        const formData = new FormData(form);
        
	    let a = formData.get("a")
        const input_a = a
	    let b = formData.get("b")
        const input_b = b
        const body = document.body,
              tbl = document.getElementById("table")
        let rows = []

        while (a > 0) {
            rows.push({
                "a": a,
                "b": b,
                "⎣b/a⎦": Math.floor(b/a)
            })
            let tmp = a
            a = b % a
            b = tmp
        }
        a = 1
        b = 0
        
        let i = rows.length-1
        while (i > 0) {
            rows[i]["α"] = a
            rows[i]["β"] = b
            let tmp = a
            a = b - (rows[i-1]["⎣b/a⎦"] * a)
            b = tmp
            i--
        }
        rows[i]["α"] = a
        rows[i]["β"] = b

        t = Table.generate("", rows, ["table", "table-striped"])
        document.getElementById("resultDiv").innerHTML = ""
        document.getElementById("resultDiv").appendChild(t)

        const erg = document.getElementById("erg")
        const solution = input_a * a + input_b * b
        erg.innerHTML = solution + " = ggt(" + input_a + ", " + input_b + ") ≛ " + input_a  + " * " + a + " + " +  input_b + " * " + b + " = " + solution

        window.history.pushState('', document.title, "?a=" + input_a + "&b=" + input_b);

    }
    
    document.getElementById("form").onsubmit = generateTable;
    const url = new URL(window.location)
    const a_value = url.searchParams.get("a")
    const b_value = url.searchParams.get("b")
    const a_input = document.getElementById("a")
    const b_input = document.getElementById("b")
    a_input.addEventListener('change', generateTable)
    b_input.addEventListener('change', generateTable)
    a_input.value = a_value
    b_input.value = b_value
    generateTable(new Event('start'))
  </script>
</html>
